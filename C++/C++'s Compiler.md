# C++の命令コンパイラー
C++コンパイラーを実行する命令はコンパイラーとOSにより変わるが、最も一般的に使われるC++の命令コンパイラーとしては、GNUコンパイラーとVisual Studioコンパイラーがある。

# GNUコンパイラー
基本的にGNUコンパイラーを実行する命令はg++(GNU C++ Compiler)である。\
因みにGNUでは、gccでもC++をコンパイルすることが出来る、gccは元々C言語用のコンパイラーで、GNU C Compilerの略語だったが、今はPascalやAdaなどの言語を支援することにより、GNU Compiler Comllectionに名前が変わっている。GCCに関してはまた今度勉強することにする。

では下の例文を見よう。

`$ g++ -o example example.cc`

「$」はシステムプロンプト、「-o example」はコンパイラーに伝達する引数、「example.cc」はc++のソースコードが入っているファイル名で、exampleという名前の実行ファイルを作成する命令である。\
ここで、OSによって実行ファイルの拡張子名も変わって来て、Windowsではexample.exe、Unixではexampleの名前で作られる。

「-o ファイル名」は引数だと説明したが、その通り、「-o ファイル名」の代わりに他の引数を入れることで他の命令を実行することができる。その例を下に記録する。

## 結果物生成
引数を追加することで、コンパイラーが実行ファイル以外にも中間段階を設定して、結果物を出すことができる。
>* -E : 前処理(Pre-Processing)過程まで終わらせて(コンパイルを遂行せずに)結果物を保存。
>* -S : コンパイル過程まで終わらせて(アセンブラーを遂行せずに)結果物を保存。
>* -c : アセンブリー過程までだけ終わらせて(リンカーを遂行せずに)結果物を保存。
>* -o <ファイル名> : <ファイル名>を持つ結果物を作成する。

```
$ g++ -E example.cc
// example.ccソースコードを前処理過程まで遂行する
$ g++ -E example.cc -o example.i
// example.ccソースコードを前処理過程まで遂行して、examplel.iに保存する。

$ g++ -S example.cc
// example.ccソースコードをコンパイル過程まで遂行する
$ g++ -S example.cc -o example.s    
// example.ccソースコードをコンパイル過程まで遂行して、examplel.sに保存する。

$ g++ -c example.cc
// example.ccソースコードをアセンブリー過程まで遂行する
$ g++ -c example.cc -o example.o
// example.ccソースコードをアセンブリー過程まで遂行して、examplel.iに保存する。
```
## コンパイル過程 
gccでは-vがバージョンの情報などを担当していることに比べ、g++での-vはネット上の情報によると、g++では、コンパイル過程や、コンパイラーから生成されたプログラムを出力させるとなっているが、g++の動作を確認しているcygwin64にgccを一緒に入れているせいか、まるでgcc -vを使っているようにバージョンの情報を示している。ただ\
`$ g++ -v example.cc -o example.txt`\
で命令を作成すると、リンカーを遂行していないような状態で保存されていた。\
この引数に関してはもう少し調べる必要がありそうだ。

## 最適化
最適化(optimization)とは与えられた条件や範囲内で、最大の効率を発揮するようにすることを意味する。最適化は勿論プログラマーの実力や経験から最も影響されるが、それ以外の要素からも最適化に違いが生じられる。その要因の一つとしてコンパイラーをあげることが出来る。

ただ、組み込み系システムプログラマーの場合、メモリーやポインターを多く扱うため、コンパイラーを用いた最適化をほぼ遂行しないので、注意が必要である。
>* -O0 : 最適化を遂行しない。
>* -O1 : 少しの最適化だけ遂行する。
>* -O2 : コードの速度が出来るだけ早いが、コードの大きさが大きくなり過ぎないように妥協して最適化を遂行する。
(最も多く使われていて、loop unrolling, function inliningに関する最適化を遂行しない。)
>* -O3 : O2最適化にインライン関数とレジスターに関する最適化を追加的に遂行。(O2より必ず早いとも言えず、コードの変形が大きい。)
>* -O5 : 結果物のサイズの最適化を遂行する。(組み込み系で良く使われる。)
>* -Os : O2最適化機能を使うが、コードの大きさは増加させない。

```
$ g++ -O0 -o example_O0 example.cc
$ g++ example.cc -o example_O1 -O1
$ g++ -O2 exaple.cc -o example_O2
//などでオプションを追加することが出来る。
```
## 複数のファイルで構成されたプログラムをコンパイルする方法
C++では一つのファイルでプログラムを作ることはほぼいない。\
大抵の状況で複数のcppファイルやヘッダーを作成し、機能を分けておく。\
しかし、このような場合ただでコンパイルしようとしても上手く通らず下記のエラーが発生する。\
`undefined reference to ~`\
このような状況に合わないためには、すべてのcppファイルを一つにまとめる必要がある。\
先ずは次の例をみよう。
```
$ ls
add.cpp add.h main.cpp sub.cpp sub.h
$ g++ -c -o add.o add.cpp
$ g++ -c -o main.o main.cpp
$ g++ -c -o sub.o sub.cpp
$ g++ -o main add.o main.o sub.o
$ g++ ./main
```
先ず、ヘッダーはコンパイルする必要はない。\
また、cppファイルは.oファイル(機械語、マシンコード等で呼ばれる)にコンパイルする。
.oファイルにしなくても実行ファイルにすることは出来るようではあるが、機械語に先にコンパイルする理由についてはまだ勉強が必要。-cを使っていることから、ヘッダーに理由があるのではないかと思われる。
